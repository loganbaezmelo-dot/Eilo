<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eilo Virtual Robot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #050505; color: white; overflow: hidden; }
        @keyframes blink { 0%, 96%, 100% { transform: scaleY(1); } 98% { transform: scaleY(0.1); } }
        .eye-blink { animation: blink 4s infinite; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        .landscape-face { display: none; }
        @media (orientation: landscape) {
            .portrait-ui { display: none; }
            .landscape-face { display: flex; }
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen">

    <!-- PORTRAIT UI -->
    <div class="portrait-ui w-full max-w-md px-6 flex flex-col h-screen py-8">
        <!-- Robot Screen -->
        <div id="robot-screen" class="w-full h-64 bg-[#111] border-2 border-pink-500/20 rounded-[50px] shadow-2xl flex items-center justify-center relative mb-6 transition-all duration-500">
            <div id="eyes-container" class="flex gap-16">
                <!-- Eyes injected by JS -->
            </div>
            <div class="absolute top-6 px-10 w-full flex justify-between items-center opacity-30 text-[10px] font-mono">
                <span>EILO_HEART_OS</span>
                <span id="battery-status">98%</span>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="flex-1 bg-[#111] rounded-[30px] p-4 flex flex-col overflow-hidden border border-white/5 shadow-xl">
            <div class="text-[10px] text-pink-400 font-bold tracking-widest mb-3 opacity-50">NEURAL LINK ACTIVE âœ¨</div>
            <div id="chat-log" class="flex-1 overflow-y-auto space-y-3 pr-1 custom-scrollbar">
                <!-- Messages injected by JS -->
            </div>
            <div class="mt-4 flex gap-2">
                <input id="user-input" type="text" placeholder="Say something sweet..." class="flex-1 bg-white/5 border border-white/10 rounded-2xl py-3 px-4 text-sm focus:outline-none focus:border-pink-500/50">
                <button id="send-btn" class="bg-pink-600 p-3 rounded-2xl hover:bg-pink-500 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </button>
            </div>
        </div>

        <!-- Controls -->
        <div class="grid grid-cols-2 gap-4 mt-6">
            <button id="mute-btn" class="bg-white/5 border border-white/5 p-4 rounded-[25px] flex flex-col items-center gap-1">
                <span id="mute-icon">ðŸ”Š</span>
                <span class="text-[10px] font-bold">AUDIO</span>
            </button>
            <button id="sleep-btn" class="bg-white/5 border border-white/5 p-4 rounded-[25px] flex flex-col items-center gap-1">
                <span id="sleep-icon">âš¡</span>
                <span class="text-[10px] font-bold">STATE</span>
            </button>
        </div>
    </div>

    <!-- LANDSCAPE FULL FACE -->
    <div class="landscape-face fixed inset-0 bg-black flex items-center justify-center">
        <div id="landscape-eyes-container" class="flex gap-32">
            <!-- Eyes injected by JS -->
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const apiKey = ""; // Managed by environment
        let mood = 'neutral';
        let isMuted = false;
        let isAwake = true;
        let isThinking = false;

        const chatLog = document.getElementById('chat-log');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const eyesPortrait = document.getElementById('eyes-container');
        const eyesLandscape = document.getElementById('landscape-eyes-container');

        // --- EYE RENDERING ---
        function updateEyes() {
            const containers = [eyesPortrait, eyesLandscape];
            containers.forEach(container => {
                if (!isAwake) {
                    container.innerHTML = `<div class="text-pink-900/20 text-4xl">ZZZ</div>`;
                    return;
                }
                
                let eyeContent = '';
                if (mood === 'happy') {
                    eyeContent = `
                        <div class="w-24 h-16 bg-pink-400 rounded-full animate-bounce"></div>
                        <div class="w-24 h-16 bg-pink-400 rounded-full animate-bounce"></div>
                    `;
                } else if (mood === 'thinking') {
                    eyeContent = `
                        <div class="w-20 h-20 bg-cyan-300 rounded-full animate-pulse blur-sm"></div>
                        <div class="w-20 h-20 bg-cyan-300 rounded-full animate-pulse blur-sm"></div>
                    `;
                } else {
                    eyeContent = `
                        <div class="w-24 h-24 bg-pink-400 rounded-3xl eye-blink shadow-[0_0_40px_rgba(244,114,182,0.5)]"></div>
                        <div class="w-24 h-24 bg-pink-400 rounded-3xl eye-blink shadow-[0_0_40px_rgba(244,114,182,0.5)]"></div>
                    `;
                }
                container.innerHTML = eyeContent;
            });
        }

        // --- BRAIN (GEMINI) ---
        async function askEilo(text) {
            if (isThinking) return;
            isThinking = true;
            mood = 'thinking';
            updateEyes();
            addMessage('user', text);

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text }] }],
                        systemInstruction: { parts: [{ text: "You are Eilo, a sweet, energetic, and cute desktop robot. You love your owner. Use cute emojis like âœ¨, ðŸŽ€, ðŸŽˆ, and ðŸŒˆ. NEVER use skulls or crying emojis. Keep responses short and cheerful." }] }
                    })
                });
                const data = await response.json();
                const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "I love you! âœ¨";
                
                addMessage('eilo', reply);
                speak(reply);
                mood = 'happy';
                updateEyes();
                setTimeout(() => { mood = 'neutral'; updateEyes(); }, 3000);
            } catch (e) {
                console.error(e);
                mood = 'neutral';
                updateEyes();
            } finally {
                isThinking = false;
            }
        }

        // --- SPEECH (TTS) ---
        async function speak(text) {
            if (isMuted) return;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Say in a sweet, robotic, and cute tone: ${text}` }] }],
                        generationConfig: {
                            responseModalities: ["AUDIO"],
                            speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Puck" } } }
                        }
                    })
                });
                const data = await response.json();
                const b64 = data.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                if (b64) {
                    const audio = new Audio("data:audio/wav;base64," + b64); // Simple fallback check
                    // For PCM to WAV, use the logic from previous artifacts if needed, 
                    // but most browsers handle high-quality data uri for audio well.
                    // Implementation note: Actual PCM conversion omitted for brevity but recommended for production.
                    playPcm(b64);
                }
            } catch (e) {}
        }

        function playPcm(base64) {
            const pcm = Uint8Array.from(atob(base64), c => c.charCodeAt(0));
            const header = new ArrayBuffer(44);
            const d = new DataView(header);
            const s = (o, str) => { for (let i = 0; i < str.length; i++) d.setUint8(o + i, str.charCodeAt(i)); };
            s(0, 'RIFF'); d.setUint32(4, 36 + pcm.length, true); s(8, 'WAVE'); s(12, 'fmt ');
            d.setUint32(16, 16, true); d.setUint16(20, 1, true); d.setUint16(22, 1, true);
            d.setUint32(24, 24000, true); d.setUint32(28, 48000, true); d.setUint16(32, 2, true);
            d.setUint16(34, 16, true); s(36, 'data'); d.setUint32(40, pcm.length, true);
            const blob = new Blob([header, pcm], { type: 'audio/wav' });
            new Audio(URL.createObjectURL(blob)).play();
        }

        function addMessage(role, text) {
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            div.innerHTML = `<div class="px-4 py-2 rounded-2xl text-xs ${role === 'user' ? 'bg-pink-600/20 text-pink-100' : 'bg-white/5 text-slate-300'}">${text}</div>`;
            chatLog.appendChild(div);
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        // --- INTERACTION ---
        sendBtn.onclick = () => {
            if (userInput.value.trim()) {
                askEilo(userInput.value);
                userInput.value = '';
            }
        };

        userInput.onkeydown = (e) => { if (e.key === 'Enter') sendBtn.onclick(); };

        document.getElementById('mute-btn').onclick = () => {
            isMuted = !isMuted;
            document.getElementById('mute-icon').innerText = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
        };

        document.getElementById('sleep-btn').onclick = () => {
            isAwake = !isAwake;
            updateEyes();
        };

        // Init
        updateEyes();
    </script>
</body>
</html>

